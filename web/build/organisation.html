{% extends "main.html" %}

{% block head %}
    {{ jimi.jquery() }}
{% endblock %}

{% block main %}
    <script src="{{ url_for('static', filename='javascript/alert.js') }}"></script>
    <div class="container px-4 py-5">
        <div id="alertArea"></div>
        <h2>General Details</h2>
        <br>
        <form>
            <div class="form-group">
                <label for="name">Organisation Name</label>
                {% if organisation|length > 0 %}
                    <input type="text" class="form-control textbox" id="name" value="{{ organisation[0]['name'] }}" aria-describedby="nameHelp">
                {% else %}
                    <input type="text" class="form-control textbox" id="name" value="" aria-describedby="nameHelp">
                {% endif %}
                <small id="nameHelp" class="form-text text-muted">The name of the organsation using JIMI</small>
                <br>
                <label for="loginTypes">Authentication Types</label>
                <br>
                {% for type in loginTypes %}
                    <div class="form-switch">
                    {% if type["enabled"] == true %}
                        <input class="form-check-input" name="authTypes" type="checkbox" value="{{ type["name"] }}" aria-label="{{ type["name"] }}" checked>
                        {{ type["name"] }}
                    {% else %}
                        <input class="form-check-input" name="authTypes" type="checkbox" value="{{ type["name"] }}" aria-label="{{ type["name"] }}">
                        {{ type["name"] }}
                    {% endif %}
                    </div> 
                {% endfor %}
                <small id="authTypeHelp" class="form-text text-muted">The methods of authentication users can use on the system</small>
            </div>
        </form>
        <button type="button" class="btn btn-primary button bi-save" onclick="editOrganisation()"> Save</button>
        <hr>
        <h2>Users and Groups</h2>
        <br>
        <a type="button" class="btn btn-primary button bi-person" href="/admin/users"> Edit Users</a>
        <a type="button" class="btn btn-primary button bi-people" href="/admin/groups"> Edit Groups</a>
    </div>
    <script>
        function editOrganisation() {
                var authTypes = [];
                for (var pair of new FormData(document.querySelector("form")).entries())
                {
                    authTypes.push(pair[1])
                }
                var body = JSON.stringify({ CSRF : CSRF, name: $("#name").val(), authTypes: authTypes })
                $.ajax({ type : "POST",  data:body, contentType:"application/json", 
                    success: function ( result ) 
                    {
                        dropdownAlert($("#alertArea"),"success","Organisation updated successfully",2500);
                    },
                    error: function ( result )
                    {
                        dropdownAlert($("#alertArea"),"error",result.responseJSON.message,2500);
                    }
                });
        }
    </script>
{% endblock %}